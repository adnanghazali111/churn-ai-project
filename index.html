<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Churn AI Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: #111827;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px 10px;
            background-color: #e9ecef;
        }

        /* Main Split Card Container */
        .dashboard-wrapper {
            display: flex;
            width: 100%;
            max-width: 1100px;
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            padding: 12px; 
            gap: 20px;
        }

        @media (max-width: 900px) {
            .dashboard-wrapper {
                flex-direction: column;
            }
        }

        /* Left Branding Panel (Gradient & Description) */
        .branding-panel {
            flex: 1;
            background: linear-gradient(145deg, #fdf0e6 0%, #f4a27e 100%);
            border-radius: 16px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .logo {
            font-weight: 600;
            font-size: 1.2rem;
            color: #111;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 40px;
        }

        .branding-text h2 {
            font-size: 2rem;
            font-weight: 600;
            line-height: 1.2;
            color: #111;
            letter-spacing: -0.02em;
            margin-bottom: 20px;
        }

        .branding-desc {
            color: #374151;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .branding-desc > p {
            margin-bottom: 24px;
        }

        .feature-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .feature-list li {
            position: relative;
            padding-left: 28px;
        }

        .feature-list li::before {
            content: '✦';
            position: absolute;
            left: 0;
            top: 2px;
            color: #d946ef;
            font-size: 1.1rem;
        }

        .branding-footer {
            margin-top: 40px;
            font-size: 0.85rem;
            color: #4b5563;
            font-weight: 500;
        }

        /* Right Form Panel */
        .form-panel {
            flex: 1.1;
            padding: 40px 40px 20px 20px;
            display: flex;
            flex-direction: column;
            min-width: 0; 
        }

        .asterisk {
            color: #e07a5f;
            font-size: 2rem;
            line-height: 1;
            margin-bottom: 16px;
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: -0.03em;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .input-row {
            display: flex;
            gap: 16px;
        }

        input, textarea {
            width: 100%;
            padding: 14px 1.5px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            color: #111827;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.2s ease;
        }

        /* Ensure placeholder color is visible enough for the animation */
        input::placeholder, textarea::placeholder { color: #9ca3af; }

        input:focus, textarea:focus {
            border-color: #d1d5db;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Button */
        button {
            width: 100%;
            padding: 16px;
            background-color: #0b0f19;
            color: #ffffff;
            font-weight: 500;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 8px 16px rgba(11, 15, 25, 0.2);
        }

        button:hover { background-color: #1f2937; }
        button:active { transform: translateY(1px); }
        button:disabled { cursor: not-allowed; opacity: 0.7; }

        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 32px 0 24px 0;
        }
        
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .divider span {
            padding: 0 16px;
            color: #9ca3af;
            font-size: 0.8rem;
        }

        /* Results Pane */
        .result {
            margin-bottom: 20px;
            padding: 20px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            display: none; 
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
        }

        .result.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .result p {
            font-size: 0.9rem;
            color: #4b5563;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
        }

        .result strong { color: #111827; }

        /* History List */
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding-right: 4px;
        }

        .history-list::-webkit-scrollbar { width: 4px; }
        .history-list::-webkit-scrollbar-track { background: transparent; }
        .history-list::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }

        .empty-history {
            text-align: center;
            color: #9ca3af;
            font-size: 0.85rem;
            font-style: italic;
        }

        .history-item {
            border: 1px solid #e5e7eb;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #4b5563;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f3f4f6;
        }

        .risk-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-High { background: #fee2e2; color: #991b1b; }
        .risk-Medium { background: #fef3c7; color: #92400e; }
        .risk-Low { background: #d1fae5; color: #065f46; }
        
        .snippet {
            font-style: italic;
            color: #6b7280;
            margin-top: 8px;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body>

    <div class="dashboard-wrapper">
        
        <div class="branding-panel">
            <div>
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                    Churn AI
                </div>
                
                <div class="branding-text">
                    <h2>Stop churn before it happens.</h2>
                </div>

                <div class="branding-desc">
                    <p>Churn AI is an intelligent customer retention assistant that helps businesses identify customers who are likely to cancel their subscription before they actually leave. By analyzing a customer’s support message along with key behavioral details such as complaint history, refunds taken, and subscription duration, the system predicts the probability of churn, assigns a clear risk level (Low, Medium, or High), and calculates a risk score. It also automatically generates a personalized retention message to help you respond quickly and effectively. This tool empowers support and customer success teams to prioritize high-risk users, improve engagement, and reduce churn through data-driven decisions and smart AI-powered insights.</p>
                    
                </div>
            </div>

            <div class="branding-footer">
                Empowering support teams with smart, AI-driven insights.
            </div>
        </div>

        <div class="form-panel">
            <div class="asterisk">✱</div>
            <h1>Predict Churn</h1>
            <p class="subtitle">Enter customer metrics and support context to calculate their retention likelihood instantly.</p>

            <div class="input-group">
                <textarea id="ticket" placeholder=""></textarea>

                <div class="input-row">
                    <input type="number" id="complaint" placeholder="Complaint Count" min="0">
                    <input type="number" id="refund" placeholder="Refunds Taken" min="0">
                    <input type="number" id="subscription" placeholder="Subcription Months" min="0">
                </div>
            </div>

            <button id="predictBtn" onclick="predict()">Analyze Risk</button>

            <div class="divider">
                <span>Results & History</span>
            </div>

            <div class="result" id="output"></div>

            <div class="history-list" id="historyList">
                <div class="empty-history">No predictions yet. Run an analysis above.</div>
            </div>
        </div>
    </div>

<script>
// --- Typing Animation Logic ---
const placeholderExamples = [
    "e.g., This is unacceptable. I’ve complained multiple times...",
    "e.g., I’m not completely satisfied with the recent update...",
    "e.g., Everything works well. Just needed help with resetting my password...",
    "e.g., Worst customer service ever. I want a refund...",
    "e.g., There have been a few bugs lately. Can you look into this?"
];

let currentExampleIndex = 0;
let currentCharIndex = 0;
let isDeleting = false;
let typingSpeed = 40; // milliseconds per character when typing
let deletingSpeed = 20; // milliseconds per character when deleting
let pauseTime = 1500; // how long to pause before deleting

function typePlaceholder() {
    const textarea = document.getElementById('ticket');
    const currentString = placeholderExamples[currentExampleIndex];

    // Build the string up or tear it down
    if (isDeleting) {
        textarea.setAttribute('placeholder', currentString.substring(0, currentCharIndex));
        currentCharIndex--;
    } else {
        textarea.setAttribute('placeholder', currentString.substring(0, currentCharIndex));
        currentCharIndex++;
    }

    // Determine current speed based on whether we are deleting or typing
    let currentSpeed = isDeleting ? deletingSpeed : typingSpeed;

    // Logic for pausing and switching directions
    if (!isDeleting && currentCharIndex === currentString.length + 1) {
        isDeleting = true;
        currentSpeed = pauseTime; // Pause at the end of the full sentence
    } else if (isDeleting && currentCharIndex === 0) {
        isDeleting = false;
        currentExampleIndex = (currentExampleIndex + 1) % placeholderExamples.length;
        currentSpeed = 500; // Small pause before starting the next string
    }

    setTimeout(typePlaceholder, currentSpeed);
}

// Start the typing animation when the page loads
document.addEventListener("DOMContentLoaded", () => {
    typePlaceholder();
});
// ------------------------------

// Array to store previous predictions
let predictionHistory = [];

async function predict() {
    const btn = document.getElementById("predictBtn");
    const outputDiv = document.getElementById("output");

    const ticketText = document.getElementById("ticket").value;

    const data = {
        ticket_text: ticketText,
        complaint_count: parseInt(document.getElementById("complaint").value) || 0,
        refunds_taken: parseInt(document.getElementById("refund").value) || 0,
        subscription_months: parseInt(document.getElementById("subscription").value) || 0
    };

    btn.innerText = "Processing...";
    btn.disabled = true;
    outputDiv.classList.remove("show");

    try {
        const response = await fetch("https://churn-ai-project.onrender.com/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            throw new Error("Server error");
        }

        const result = await response.json();

        outputDiv.innerHTML = `
            <p>Churn Probability: <strong>${(result.churn_probability * 100).toFixed(1)}%</strong></p>
            <p>Risk Score: <strong>${result.risk_score.toFixed(1)}</strong></p>
            <p>Risk Level: <strong class="risk-badge risk-${result.risk_level}">${result.risk_level}</strong></p>
            <div style="margin-top:15px; font-size: 0.85rem; color: #4b5563;">
                <strong>Retention Message:</strong>
                <p style="margin-top:8px; line-height:1.5; background: #fff; padding: 10px; border-radius: 6px; border: 1px solid #e5e7eb;">${result.retention_email || 'No message provided.'}</p>
            </div>
        `;

        requestAnimationFrame(() => outputDiv.classList.add("show"));

        addToHistory({
            probability: (result.churn_probability * 100).toFixed(1),
            riskLevel: result.risk_level,
            snippet: ticketText ? `"${ticketText.substring(0, 40)}..."` : "No ticket provided",
            time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
        });

    } catch (error) {
        outputDiv.innerHTML = `<p style="color: #ef4444;">Error connecting to the server. Please try again.</p>`;
        outputDiv.classList.add("show");
    } finally {
        btn.innerText = "Analyze Risk";
        btn.disabled = false;
    }
}

function addToHistory(entry) {
    predictionHistory.unshift(entry);
    
    const historyList = document.getElementById("historyList");
    historyList.innerHTML = ""; 

    predictionHistory.forEach(item => {
        const riskClass = item.riskLevel ? `risk-${item.riskLevel.charAt(0).toUpperCase() + item.riskLevel.slice(1).toLowerCase()}` : '';

        const historyCard = document.createElement("div");
        historyCard.className = "history-item";
        historyCard.innerHTML = `
            <div class="history-header">
                <span style="color: #9ca3af; font-size: 0.8rem;">${item.time}</span>
                <span class="risk-badge ${riskClass}">${item.riskLevel}</span>
            </div>
            <div style="margin-bottom: 4px;">
                Probability: <strong style="color: #111">${item.probability}%</strong>
            </div>
            <span class="snippet">${item.snippet}</span>
        `;
        historyList.appendChild(historyCard);
    });
}
</script>

</body>
</html>